
<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>Quick Quiz Builder V8 + DeepSeek</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;max-width:900px;margin:0 auto;padding:24px;background:#f7f7f7}
h1{margin-bottom:12px}
textarea{width:100%;height:240px;font-family:Consolas,monospace;font-size:14px;padding:8px;border:1px solid #ccc;border-radius:4px}
button{padding:6px 14px;font-size:15px;margin:5px 4px;border:none;border-radius:4px;cursor:pointer;background:#1976d2;color:#fff}
button[disabled]{background:#999;cursor:not-allowed}
#quiz-container{background:#fff;padding:20px;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,.15);margin-top:20px;display:none;position:relative}
.option{margin:6px 0;display:block}
.feedback{margin-top:10px;font-weight:bold}
.correct{color:#2e7d32}
.incorrect{color:#c62828}
#top-btns{position:absolute;top:10px;right:10px;display:flex;gap:6px;z-index:10}
.top-icon{font-size:18px;background:none;border:none;color:#d32f2f;padding:0 4px;cursor:pointer}
.top-icon.jump{color:#00897b}
.top-icon.faved{color:#fdd835}
.modal{display:none;position:fixed;top:10%;left:50%;transform:translateX(-50%);width:85%;max-width:650px;background:#fff;border-radius:8px;box-shadow:0 4px 12px rgba(0,0,0,.3);max-height:80%;overflow:auto;padding:18px}
.modal h2{margin-top:0}
.jump-grid{display:flex;flex-wrap:wrap;gap:6px}
.jump-grid button{width:42px;border-radius:4px;padding:6px 0;background:#607d8b}
.jump-grid button.done{background:#90caf9;color:#000}
.jump-grid button.current{border:2px solid #ffeb3b}
#explainBtn{background:#00897b}
</style>
</head>
<body>
<h1>QuickÂ QuizÂ BuilderÂ V8 + DeepSeek</h1>
<p>ç²˜è´´é¢˜åº“ï¼Œæ•°å­— <strong>1â€“8</strong> å¿«é€Ÿé€‰é¡¹ï¼Œ<strong>Enter</strong> æäº¤/ä¸‹ä¸€é¢˜ã€‚</p>

<textarea id="raw-input" placeholder="æŠŠé¢˜åº“ç²˜è´´åˆ°è¿™é‡Œâ€¦"></textarea><br>
<button id="build-btn">ç”Ÿæˆåˆ·é¢˜</button>
<button id="save-btn" style="background:#455a64">ä¿å­˜é¢˜åº“</button>
<button id="show-bank-btn" style="background:#37474f">é¢˜åº“</button>
<button id="fav-quiz-btn" style="display:none;background:#388e3c">åˆ·æ”¶è—é¢˜</button>
<button id="manage-fav-btn" style="display:none;background:#8e24aa">ç®¡ç†æ”¶è—å¤¹</button>

<div id="quiz-container">
  <div id="top-btns">
    <button id="jump-btn" class="top-icon jump" title="é¢˜å·å¯¼èˆª">ğŸ“‘</button>
    <button id="fav-btn" class="top-icon" title="æ”¶è—/å–æ¶ˆæ”¶è—">â˜…</button>
  </div>
  <div id="q-num"></div>
  <p id="question-text" class="question-text"></p>
  <div id="options-area"></div>
  <button id="prev-btn" style="display:none;background:#5e35b1">ä¸Šä¸€é¢˜</button>
  <button id="action-btn" disabled>æäº¤</button>
  <!-- è§£é‡ŠåŒº -->
  <button id="explainBtn" style="display:none;">ç”Ÿæˆè§£æ</button>
  <pre id="explainBox"></pre>
  <p id="feedback" class="feedback"></p>
</div>

<!-- å…¶ä½™æ¨¡æ€æ¡†åŒä¸Šçœç•¥ï¼Œä¸º brevity -->

<script>
// ===== ç°æœ‰JSé€»è¾‘ï¼ˆçœç•¥ï¼Œä»…ç¤ºä¾‹ä¿ç•™æ ¸å¿ƒå˜é‡ï¼‰ =====
const questionTextEl = document.getElementById('question-text');
const optionsArea = document.getElementById('options-area');
const explainBtn = document.getElementById('explainBtn');
const explainBox = document.getElementById('explainBox');

// å‡è®¾æœ‰å…¨å±€å˜é‡ current, quiz, userChoices å·²ç”±åŸè„šæœ¬ç»´æŠ¤
// ä¸‹é¢é’©åˆ°æäº¤åæ˜¾ç¤ºæŒ‰é’®
document.addEventListener('quiz-graded', () => {
  explainBtn.style.display = 'inline-block';
});

// DeepSeek è°ƒç”¨
async function askDeepSeek(prompt){
  const res = await fetch('/api/explain', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({prompt})
  });
  const data = await res.json();
  return data.explanation || 'è§£æå¤±è´¥';
}

explainBtn.addEventListener('click', async () => {
  const qText = questionTextEl.innerText;
  const opts = Array.from(optionsArea.querySelectorAll('label')).map(l=>l.innerText).join('\n');
  const myAns = (window.userChoices && window.userChoices[window.current]) ? window.userChoices[window.current].join(',') : '';
  const prompt = `é¢˜ç›®ï¼š${qText}\né€‰é¡¹ï¼š\n${opts}\næˆ‘é€‰æ‹©çš„ç­”æ¡ˆï¼š${myAns}\nè¯·ç»™å‡ºæ­£ç¡®ç­”æ¡ˆå¹¶ç®€è¦è§£æï¼ˆ200å­—å†…ï¼‰ã€‚`;

  explainBox.textContent = 'â³ è§£æç”Ÿæˆä¸­...';
  try{
    const txt = await askDeepSeek(prompt);
    explainBox.textContent = txt;
  }catch(e){
    explainBox.textContent = 'è§£æå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';
  }
});
</script>
</body>
</html>
